<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SoloTravel · Hyper Companion</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />

    <!-- App Styles -->
    <link rel="stylesheet" href="style.css" />
</head>

<body class="bg-app">
    <div class="min-vh-100 d-flex flex-column">

        <!-- Top App Bar -->
        <header class="border-bottom bg-white bg-opacity-75 backdrop-blur sticky-top">
            <div class="container-fluid py-2 px-3 px-md-4 d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center gap-2">
                    <div class="rounded-circle bg-gradient-primary text-white d-flex align-items-center justify-content-center shadow-sm" style="width:36px;height:36px;">
                        <i class="fa-solid fa-compass"></i>
                    </div>
                    <div class="d-flex flex-column">
                        <span class="small text-uppercase text-muted fw-semibold">
                            SoloTravel
                        </span>
                        <span class="fw-bold d-flex align-items-center gap-1">
                            Companion
                            <span class="badge bg-primary-subtle text-primary rounded-pill small">
                                <i class="fa-solid fa-wand-magic-sparkles me-1"></i> Smart
                            </span>
                        </span>
                    </div>
                </div>

                <div class="d-flex align-items-center gap-3">
                    <div class="d-none d-md-flex flex-column text-end">
                        <span class="small text-muted d-flex justify-content-end align-items-center gap-1">
                            <i class="fa-solid fa-location-dot text-danger"></i> Live Location
                        </span>
                        <span class="small fw-semibold text-truncate" id="headerLocationLabel">
                            Off · tap Enable
                        </span>
                    </div>

                    <button class="btn btn-outline-primary btn-sm d-flex align-items-center gap-2 rounded-pill shadow-sm" id="btnLocation" type="button">
                        <i class="fa-solid fa-location-crosshairs"></i>
                        <span class="d-none d-sm-inline">Enable</span>
                    </button>

                    <div class="position-relative">
                        <div class="rounded-circle border bg-white overflow-hidden shadow-sm" style="width:40px;height:40px;">
                            <img src="https://ui-avatars.com/api/?name=Alex+Traveler&background=random" class="w-100 h-100 object-fit-cover" alt="Profile" />
                        </div>
                        <span class="position-absolute bottom-0 end-0 translate-middle p-1 bg-success border border-white rounded-circle"></span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Risk Banner -->
        <div id="riskBanner" class="bg-gradient-danger text-white small py-2 px-3 d-none">
            <div class="container-fluid d-flex justify-content-between align-items-center gap-2">
                <div class="d-flex flex-column">
                    <div class="fw-semibold d-flex align-items-center gap-2">
                        <i class="fa-solid fa-triangle-exclamation"></i>
                        <span>Route looks a bit risky</span>
                    </div>
                    <div class="opacity-75">
                        Stay on brighter, busier streets and avoid shortcuts or empty lanes for now.
                    </div>
                </div>
                <button class="btn btn-light btn-sm rounded-pill fw-semibold px-3" id="btnImSafe">
                    I'm safe
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <main class="flex-grow-1 d-flex flex-column">
            <div class="container-fluid px-0 px-md-3 py-2 py-md-3 flex-grow-1 d-flex">

                <!-- Sidebar (desktop) -->
                <aside class="d-none d-md-flex flex-column border-end bg-white bg-opacity-90 backdrop-blur shadow-sm" style="width:240px;">
                    <div class="p-3 border-bottom">
                        <div class="small text-muted mb-2 text-uppercase fw-semibold d-flex align-items-center justify-content-between">
                            <span>Navigate</span>
                            <span class="badge bg-gradient-pill text-white small">APP</span>
                        </div>
                        <div class="nav nav-pills flex-column gap-1" id="navMain">
                            <button class="nav-link active d-flex align-items-center gap-2 py-2 px-3 rounded-3" data-bs-target="#appCarousel" data-bs-slide-to="0" type="button">
                                <i class="fa-solid fa-map-location-dot"></i>
                                <span>Map</span>
                            </button>
                            <button class="nav-link d-flex align-items-center gap-2 py-2 px-3 rounded-3" data-bs-target="#appCarousel" data-bs-slide-to="1" type="button">
                                <i class="fa-solid fa-lightbulb"></i>
                                <span>Suggestions</span>
                            </button>
                            <button class="nav-link d-flex align-items-center gap-2 py-2 px-3 rounded-3" data-bs-target="#appCarousel" data-bs-slide-to="2" type="button">
                                <i class="fa-solid fa-calendar-day"></i>
                                <span>Itinerary</span>
                            </button>
                            <button class="nav-link d-flex align-items-center gap-2 py-2 px-3 rounded-3" data-bs-target="#appCarousel" data-bs-slide-to="3" type="button">
                                <i class="fa-solid fa-shield-heart"></i>
                                <span>Safety</span>
                            </button>
                            <button class="nav-link d-flex align-items-center gap-2 py-2 px-3 rounded-3" data-bs-target="#appCarousel" data-bs-slide-to="4" type="button">
                                <i class="fa-solid fa-message"></i>
                                <span>Chat</span>
                            </button>
                        </div>
                    </div>

                    <!-- Safety summary -->
                    <div class="p-3 mt-auto border-top small">
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <div class="d-flex align-items-center gap-2">
                                <span class="rounded-circle bg-success" style="width:9px;height:9px;" id="safetyDotMini"></span>
                                <span class="text-muted">Safety</span>
                            </div>
                            <span id="safetyStatusChip" class="badge rounded-pill bg-success-subtle text-success d-flex align-items-center gap-1">
                                <i class="fa-solid fa-shield-halved"></i> Safe zone
                            </span>
                        </div>
                        <p class="mb-2 text-muted small" id="safetyStatusText">
                            Enable Live Location so I can softly warn you if you wander too far from your comfort circle.
                        </p>
                        <button class="btn btn-danger w-100 btn-sm rounded-pill mb-1 d-flex justify-content-center align-items-center gap-2" id="btnSOS" disabled>
                            <i class="fa-solid fa-triangle-exclamation"></i>
                            SOS / 112
                        </button>
                        <div class="text-muted small">
                            Add at least <span class="fw-semibold">3 contacts</span> to unlock SOS.
                        </div>
                        <button class="btn btn-link p-0 mt-2 small text-decoration-none d-inline-flex align-items-center gap-1" data-bs-toggle="modal" data-bs-target="#contactsModal">
                            <i class="fa-solid fa-user-group"></i>
                            Manage emergency contacts
                        </button>
                    </div>
                </aside>

                <!-- App Screen + Chat -->
                <div class="flex-grow-1 d-flex flex-column flex-md-row">

                    <!-- App Screen -->
                    <section class="flex-grow-1 d-flex flex-column">

                        <!-- Greeting + Mood -->
                        <div class="px-3 px-md-4 pt-2 pb-1">
                            <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-2">
                                <div class="d-flex flex-column">
                                    <div class="d-flex align-items-center gap-2">
                                        <h5 class="mb-0 fw-bold" id="greetingTitle">Good Morning, Alex</h5>
                                        <span class="badge rounded-pill bg-success-subtle text-success small d-flex align-items-center gap-1">
                                            <i class="fa-solid fa-heart-pulse"></i>
                                            Feeling-aware
                                        </span>
                                    </div>
                                    <div class="small text-muted mt-1">
                                        I adjust to your mood, location and energy — not the other way around.
                                    </div>
                                </div>

                                <div class="d-flex flex-column align-items-start align-items-lg-end gap-1">
                                    <div class="small text-muted d-flex align-items-center gap-1">
                                        <i class="fa-solid fa-face-smile-beam text-warning"></i>
                                        <span>Mood now</span>
                                    </div>
                                    <div class="d-flex flex-wrap gap-1" id="moodStrip">
                                        <button class="btn btn-sm btn-dark rounded-pill px-3 d-flex align-items-center gap-1 active" data-mood="Adventurous">
                                            <i class="fa-solid fa-person-hiking"></i> Adventurous
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary rounded-pill px-3 d-flex align-items-center gap-1" data-mood="Relaxed">
                                            <i class="fa-solid fa-mug-hot"></i> Relaxed
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary rounded-pill px-3 d-flex align-items-center gap-1" data-mood="Lonely">
                                            <i class="fa-solid fa-face-sad-tear"></i> Lonely
                                        </button>
                                        <button class="btn btn-sm btn-outline-secondary rounded-pill px-3 d-flex align-items-center gap-1" data-mood="Hungry">
                                            <i class="fa-solid fa-utensils"></i> Hungry
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- App Carousel -->
                        <div id="appCarousel" class="carousel slide flex-grow-1" data-bs-interval="false">
                            <div class="carousel-inner h-100">

                                <!-- Slide 0: Map -->
                                <div class="carousel-item active h-100">
                                    <div class="h-100 d-flex flex-column px-3 px-md-4 pb-3">
                                        <div class="card card-glass flex-grow-1 d-flex flex-column overflow-hidden">
                                            <div class="card-body d-flex flex-column p-3 p-md-3">
                                                <div class="d-flex align-items-center justify-content-between mb-2">
                                                    <div class="d-flex flex-column">
                                                        <div class="small text-muted mb-0 d-flex align-items-center gap-1">
                                                            <i class="fa-solid fa-location-dot text-danger"></i>
                                                            <span>Live Map</span>
                                                        </div>
                                                        <div class="fw-semibold">You are here</div>
                                                    </div>
                                                    <div class="d-flex align-items-center gap-2">
                                                        <span class="badge rounded-pill bg-primary-subtle text-primary small d-flex align-items-center gap-1">
                                                            <i class="fa-solid fa-satellite-dish"></i> Live
                                                        </span>
                                                        <span class="badge rounded-pill bg-info-subtle text-info small d-flex align-items-center gap-1">
                                                            <i class="fa-solid fa-route"></i> Safe circle
                                                        </span>
                                                    </div>
                                                </div>

                                                <div class="position-relative flex-grow-1 rounded-4 overflow-hidden mb-2 border border-light">
                                                    <div id="liveMap" class="w-100 h-100 bg-secondary-subtle">
                                                        <div class="position-absolute top-50 start-50 translate-middle text-muted small d-flex align-items-center gap-2" id="mapLoader">
                                                            <i class="fa-solid fa-spinner fa-spin"></i>
                                                            <span>Waiting for location…</span>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="small text-muted d-flex flex-wrap align-items-center justify-content-between gap-1" id="mapHintText">
                                                    <span>Tap <strong>Enable</strong> at the top to lock onto where you are.</span>
                                                    <span class="text-primary d-flex align-items-center gap-1">
                                                        <i class="fa-solid fa-hand-point-right"></i>
                                                        Pins appear as I find safe spots around you.
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Slide 1: Suggestions -->
                                <div class="carousel-item h-100">
                                    <div class="h-100 d-flex flex-column px-3 px-md-4 pb-3">
                                        <div class="card card-glass flex-grow-1 d-flex flex-column overflow-hidden">
                                            <div class="card-body d-flex flex-column p-3 p-md-3">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <div>
                                                        <div class="small text-muted mb-0 d-flex align-items-center gap-1">
                                                            <i class="fa-solid fa-lightbulb text-warning"></i>
                                                            <span>Smart Suggestions</span>
                                                        </div>
                                                        <div class="fw-semibold">Places tuned to your mood</div>
                                                    </div>
                                                    <span class="badge bg-success-subtle text-success rounded-pill small d-flex align-items-center gap-1">
                                                        <i class="fa-solid fa-brain"></i>
                                                        Mood · Location · Safety
                                                    </span>
                                                </div>

                                                <p class="small text-muted mb-2">
                                                    Once location is on, I’ll suggest <strong>3–4 nearby spots</strong> and pin them on the map.
                                                    Tap a card to jump the map to that place.
                                                </p>

                                                <div class="d-flex flex-column gap-2 small flex-grow-1 overflow-auto" id="suggestionsList">
                                                    <div class="border border-dashed rounded-3 p-3 d-flex flex-column align-items-center justify-content-center text-muted text-center">
                                                        <i class="fa-solid fa-location-crosshairs mb-1"></i>
                                                        Turn on location to fetch nearby suggestions and pins.
                                                    </div>
                                                </div>

                                                <div class="mt-2 d-flex justify-content-between align-items-center small flex-wrap gap-2">
                                                    <span class="text-muted d-flex align-items-center gap-1" id="suggestionsMoodLabel">
                                                        <i class="fa-solid fa-face-smile text-warning"></i>
                                                        Mood: Adventurous
                                                    </span>
                                                    <button class="btn btn-outline-primary btn-sm rounded-pill d-flex align-items-center gap-1" id="btnRefreshSuggestions">
                                                        <i class="fa-solid fa-rotate"></i>
                                                        Refresh
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Slide 2: Itinerary -->
                                <div class="carousel-item h-100">
                                    <div class="h-100 d-flex flex-column px-3 px-md-4 pb-3">
                                        <div class="card card-glass flex-grow-1 d-flex flex-column overflow-hidden">
                                            <div class="card-body p-3 p-md-3 d-flex flex-column">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <div>
                                                        <div class="small text-muted mb-0 d-flex align-items-center gap-1">
                                                            <i class="fa-solid fa-calendar-day text-primary"></i>
                                                            <span>Itinerary</span>
                                                        </div>
                                                        <div class="fw-semibold">Soft, adaptable plan</div>
                                                    </div>
                                                    <span class="badge rounded-pill bg-secondary-subtle text-secondary small d-flex align-items-center gap-1">
                                                        <i class="fa-solid fa-feather-pointed"></i>
                                                        Flexible
                                                    </span>
                                                </div>

                                                <p class="small text-muted mb-2">
                                                    This is just a gentle structure. I’ll never nag you to follow it — you can drift and I’ll adapt.
                                                </p>

                                                <div class="row g-2 small flex-grow-1 overflow-auto">
                                                    <div class="col-md-6">
                                                        <div class="border rounded-3 p-2 h-100 d-flex flex-column bg-white bg-opacity-75">
                                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                                <span class="badge bg-primary-subtle text-primary small rounded-pill d-flex align-items-center gap-1">
                                                                    <i class="fa-solid fa-plane-arrival"></i> Day 1
                                                                </span>
                                                                <span class="text-muted small">Arrival</span>
                                                            </div>
                                                            <ul class="mb-0 ps-3">
                                                                <li>Reach your stay via a main, well-lit road.</li>
                                                                <li>Short orientation walk around your block.</li>
                                                                <li>Note nearest café, store and a clear landmark.</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="border rounded-3 p-2 h-100 d-flex flex-column bg-white bg-opacity-75">
                                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                                <span class="badge bg-primary-subtle text-primary small rounded-pill d-flex align-items-center gap-1">
                                                                    <i class="fa-solid fa-city"></i> Day 2
                                                                </span>
                                                                <span class="text-muted small">Explore</span>
                                                            </div>
                                                            <ul class="mb-0 ps-3">
                                                                <li>Visit <strong>one</strong> major attraction slowly.</li>
                                                                <li>Lunch at a solo-friendly spot.</li>
                                                                <li>Pick a small group activity in the evening.</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="mt-2 d-flex justify-content-end small text-muted">
                                                    In a real app, this would sync with bookings, transit and check-ins.
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Slide 3: Safety -->
                                <div class="carousel-item h-100">
                                    <div class="h-100 d-flex flex-column px-3 px-md-4 pb-3">
                                        <div class="card card-glass flex-grow-1 d-flex flex-column overflow-hidden">
                                            <div class="card-body p-3 p-md-3 d-flex flex-column">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <div>
                                                        <div class="small text-muted mb-0 d-flex align-items-center gap-1">
                                                            <i class="fa-solid fa-shield-heart text-danger"></i>
                                                            <span>Safety Hub</span>
                                                        </div>
                                                        <div class="fw-semibold">Soft guardrails</div>
                                                    </div>
                                                    <span class="badge rounded-pill bg-secondary-subtle text-secondary small d-flex align-items-center gap-1" id="checkInStatusChip">
                                                        <i class="fa-solid fa-clock"></i>
                                                        No check-in
                                                    </span>
                                                </div>

                                                <div class="row g-3 small flex-grow-1 overflow-auto">
                                                    <div class="col-md-6">
                                                        <div class="border rounded-3 p-2 h-100 d-flex flex-column bg-white bg-opacity-75">
                                                            <div class="d-flex align-items-center gap-2 mb-1">
                                                                <span class="rounded-circle bg-success" style="width:10px;height:10px;" id="safetyDot"></span>
                                                                <span class="text-muted fw-semibold">Current status</span>
                                                            </div>
                                                            <p class="mb-1 text-muted" id="safetyStatusTextMain">
                                                                Waiting for your location to estimate your surroundings.
                                                            </p>
                                                            <p class="mb-0 text-muted">
                                                                I mark a “safe circle” around where you start and quietly
                                                                warn if you walk far outside it.
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="border rounded-3 p-2 h-100 d-flex flex-column bg-white bg-opacity-75">
                                                            <div class="mb-1 fw-semibold d-flex align-items-center gap-2">
                                                                <i class="fa-solid fa-stopwatch"></i>
                                                                <span>Check-in timers</span>
                                                            </div>
                                                            <p class="text-muted mb-2">
                                                                Heading somewhere? Start a timer — if you don’t check in, I treat it as a safety signal.
                                                            </p>
                                                            <div class="d-flex flex-wrap gap-2 mb-2">
                                                                <button class="btn btn-outline-primary btn-sm rounded-pill d-flex align-items-center gap-1" id="btnCheckIn15">
                                                                    <i class="fa-solid fa-clock"></i>
                                                                    15 min
                                                                </button>
                                                                <button class="btn btn-outline-primary btn-sm rounded-pill d-flex align-items-center gap-1" id="btnCheckIn30">
                                                                    <i class="fa-solid fa-clock"></i>
                                                                    30 min
                                                                </button>
                                                                <button class="btn btn-outline-secondary btn-sm rounded-pill d-flex align-items-center gap-1" id="btnCancelCheckIn">
                                                                    <i class="fa-solid fa-ban"></i>
                                                                    Cancel
                                                                </button>
                                                            </div>
                                                            <div class="text-muted small d-flex align-items-center gap-2" id="checkInCountdown">
                                                                <i class="fa-solid fa-hourglass-half"></i>
                                                                <span>No active check-in.</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-12">
                                                        <div class="border rounded-3 p-2 h-100 d-flex flex-column bg-white bg-opacity-75">
                                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                                <span class="fw-semibold d-flex align-items-center gap-2">
                                                                    <i class="fa-solid fa-user-group"></i>
                                                                    Safety Circle
                                                                </span>
                                                                <button class="btn btn-outline-secondary btn-sm rounded-pill d-flex align-items-center gap-1" data-bs-toggle="modal" data-bs-target="#contactsModal">
                                                                    <i class="fa-solid fa-user-plus"></i>
                                                                    Contacts
                                                                </button>
                                                            </div>
                                                            <p class="text-muted mb-2">
                                                                Trusted people who would get alerts if you trigger SOS or miss a check-in.
                                                            </p>
                                                            <div class="d-flex flex-wrap gap-1" id="safetyCirclePills">
                                                                <!-- Pills from JS -->
                                                                <span class="badge bg-secondary-subtle text-secondary rounded-pill small">
                                                                    Add contacts to build your circle.
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="mt-2 d-flex justify-content-end gap-2">
                                                    <button class="btn btn-outline-danger btn-sm rounded-pill d-flex align-items-center gap-1" id="btnOpenSOSConfirm" type="button">
                                                        <i class="fa-solid fa-triangle-exclamation"></i>
                                                        SOS (simulate)
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Slide 4: Chat -->
                                <div class="carousel-item h-100">
                                    <div class="h-100 d-flex flex-column px-3 px-md-4 pb-3">
                                        <div class="card card-glass flex-grow-1 d-flex flex-column overflow-hidden">
                                            <div class="card-body p-0 d-flex flex-column">
                                                <div class="border-bottom px-3 py-2 d-flex align-items-center justify-content-between bg-white bg-opacity-75">
                                                    <div class="d-flex align-items-center gap-2">
                                                        <div class="rounded-circle bg-gradient-primary text-white d-flex align-items-center justify-content-center shadow-sm" style="width:36px;height:36px;">
                                                            <i class="fa-solid fa-robot"></i>
                                                        </div>
                                                        <div>
                                                            <div class="small fw-semibold d-flex align-items-center gap-1">
                                                                Travel Companion
                                                                <span class="badge bg-success-subtle text-success rounded-pill small d-flex align-items-center gap-1">
                                                                    <i class="fa-solid fa-circle-dot"></i>
                                                                    Active
                                                                </span>
                                                            </div>
                                                            <div class="text-success small d-flex align-items-center gap-1">
                                                                <span>●</span>
                                                                <span>Watching mood, route and context</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <span class="badge bg-primary-subtle text-primary small">
                                                        BETA+
                                                    </span>
                                                </div>

                                                <div class="flex-grow-1 overflow-auto p-3 bg-chat" id="chatBox">
                                                    <!-- Messages from JS -->
                                                </div>

                                                <div class="border-top px-3 py-2 bg-white bg-opacity-75">
                                                    <div class="d-flex flex-wrap gap-1 mb-2 small" id="chatQuickStrip">
                                                        <!-- Quick chips from JS -->
                                                    </div>
                                                    <div class="input-group input-group-sm shadow-sm rounded-pill overflow-hidden">
                                                        <input type="text" class="form-control border-0 bg-white" placeholder="Type how you feel or ask anything…" id="chatInput" />
                                                        <button class="btn btn-primary px-3" type="button" id="btnSend">
                                                            <i class="fa-solid fa-paper-plane"></i>
                                                        </button>
                                                    </div>
                                                    <div class="small text-muted mt-1">
                                                        Try:
                                                        <span class="fw-semibold">“I feel anxious walking back”</span>,
                                                        <span class="fw-semibold">“Is this neighbourhood safe?”</span>,
                                                        <span class="fw-semibold">“Translate this to Spanish”</span>.
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>

                            <!-- Carousel controls (desktop only) -->
                            <button class="carousel-control-prev d-none d-md-flex" type="button" data-bs-target="#appCarousel" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next d-none d-md-flex" type="button" data-bs-target="#appCarousel" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                        </div>
                    </section>

                    <!-- Chat aside mirror (big screens) -->
                    <aside class="d-none d-xxl-flex flex-column border-start bg-white bg-opacity-90 backdrop-blur shadow-sm" style="width:320px;">
                        <div class="p-3 border-bottom d-flex align-items-center gap-2">
                            <div class="rounded-circle bg-gradient-primary text-white d-flex align-items-center justify-content-center shadow-sm" style="width:36px;height:36px;">
                                <i class="fa-solid fa-robot"></i>
                            </div>
                            <div class="d-flex flex-column">
                                <span class="small fw-semibold">Companion (side view)</span>
                                <span class="small text-success d-flex align-items-center gap-1">
                                    <span>●</span>
                                    <span>Chat while exploring other tabs</span>
                                </span>
                            </div>
                        </div>
                        <div class="flex-grow-1 overflow-auto p-3 bg-chat" id="chatBoxAside">
                            <div class="small text-muted mb-2">
                                This view mirrors the main chat. Anything you send or receive appears here too.
                            </div>
                        </div>
                    </aside>
                </div>
            </div>
        </main>

        <!-- Bottom nav (mobile) -->
        <nav class="d-md-none border-top bg-white bg-opacity-95 backdrop-blur">
            <div class="d-flex text-center small">
                <button type="button" class="flex-fill py-2 border-0 bg-transparent nav-bottom-btn active d-flex flex-column align-items-center justify-content-center gap-1" data-bs-target="#appCarousel" data-bs-slide-to="0">
                    <i class="fa-solid fa-map-location-dot"></i>
                    <span>Map</span>
                </button>
                <button type="button" class="flex-fill py-2 border-0 bg-transparent nav-bottom-btn d-flex flex-column align-items-center justify-content-center gap-1" data-bs-target="#appCarousel" data-bs-slide-to="1">
                    <i class="fa-solid fa-lightbulb"></i>
                    <span>Ideas</span>
                </button>
                <button type="button" class="flex-fill py-2 border-0 bg-transparent nav-bottom-btn d-flex flex-column align-items-center justify-content-center gap-1" data-bs-target="#appCarousel" data-bs-slide-to="3">
                    <i class="fa-solid fa-shield-heart"></i>
                    <span>Safety</span>
                </button>
                <button type="button" class="flex-fill py-2 border-0 bg-transparent nav-bottom-btn d-flex flex-column align-items-center justify-content-center gap-1" data-bs-target="#appCarousel" data-bs-slide-to="4">
                    <i class="fa-solid fa-message"></i>
                    <span>Chat</span>
                </button>
            </div>
        </nav>
    </div>

    <!-- Floating SOS FAB -->
    <button class="btn btn-danger rounded-circle shadow-lg position-fixed d-flex align-items-center justify-content-center" style="right:1.25rem;bottom:4.5rem;width:56px;height:56px;z-index:1080;" id="btnFabSOS" disabled type="button">
        <i class="fa-solid fa-triangle-exclamation"></i>
    </button>

    <!-- Emergency Contacts Modal -->
    <div class="modal fade" id="contactsModal" tabindex="-1" aria-labelledby="contactsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <form id="contactsForm">
                    <div class="modal-header">
                        <h5 class="modal-title" id="contactsModalLabel">
                            Emergency contacts
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p class="small text-muted mb-2">
                            Add at least <span class="fw-semibold">3 trusted people</span>.
                            In a real app they’d get your location if SOS or a missed check-in happens.
                        </p>

                        <div id="contactsContainer" class="vstack gap-2 small">
                            <!-- initial 3 rows -->
                            <div class="row g-2 contact-row">
                                <div class="col-5">
                                    <input type="text" class="form-control form-control-sm contact-name" placeholder="Name" required />
                                </div>
                                <div class="col-5">
                                    <input type="tel" class="form-control form-control-sm contact-phone" placeholder="Phone" required />
                                </div>
                                <div class="col-2">
                                    <input type="text" class="form-control form-control-sm contact-relation" placeholder="Rel." />
                                </div>
                            </div>
                            <div class="row g-2 contact-row">
                                <div class="col-5">
                                    <input type="text" class="form-control form-control-sm contact-name" placeholder="Name" required />
                                </div>
                                <div class="col-5">
                                    <input type="tel" class="form-control form-control-sm contact-phone" placeholder="Phone" required />
                                </div>
                                <div class="col-2">
                                    <input type="text" class="form-control form-control-sm contact-relation" placeholder="Rel." />
                                </div>
                            </div>
                            <div class="row g-2 contact-row">
                                <div class="col-5">
                                    <input type="text" class="form-control form-control-sm contact-name" placeholder="Name" required />
                                </div>
                                <div class="col-5">
                                    <input type="tel" class="form-control form-control-sm contact-phone" placeholder="Phone" required />
                                </div>
                                <div class="col-2">
                                    <input type="text" class="form-control form-control-sm contact-relation" placeholder="Rel." />
                                </div>
                            </div>
                        </div>

                        <button type="button" class="btn btn-link p-0 mt-2 small d-inline-flex align-items-center gap-1" id="btnAddContactRow">
                            <i class="fa-solid fa-plus"></i>
                            Add another
                        </button>

                        <div id="contactsError" class="alert alert-danger py-1 px-2 mt-2 small d-none"></div>
                        <div id="contactsSuccess" class="alert alert-success py-1 px-2 mt-2 small d-none"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-secondary btn-sm rounded-pill" data-bs-dismiss="modal">
                            Close
                        </button>
                        <button type="submit" class="btn btn-primary btn-sm rounded-pill">
                            Save
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- App Logic -->
    <script src="script.js"></script>
</body>

</html>